#!/usr/bin/env bash
set -e

LOG_DIR="/var/vcap/sys/log/uaa_delete"

mkdir -p "$LOG_DIR"

chown -R vcap:vcap "$LOG_DIR"

export CREDHUB_CLIENT_ID=<%= p("credhub.identity") %>
export CREDHUB_CLIENT_PASSWORD=<%= p("credhub.password") %>
export CREDHUB_URL=<%= p("credhub.endpoint") %>
export CREDHUB_CRED_PATH=<%= p("credhub.credential_path") %>

/var/vcap/jobs/uaa_delete/packages/uaa_crud_pkg/uaa-crud.linux delete --uaa-endpoint <%= p("uaacrud.endpoint") %> \
  --admin-identity <%= p("uaacrud.admin_identity") %> \
  --admin-pwd <%= p("uaacrud.admin_password") %> \
  --target-client-identity <%= p("uaacrud.target_client_identity") %> -v \
   1>> "$LOG_DIR/uaa_delete.stdout.log" \
   2>> "$LOG_DIR/uaa_delete.stderr.log"